{"ast":null,"code":"var _jsxFileName = \"/home/botrott/Dev/kittygram_frontend/src/components/edit-card-page/edit-card-page.jsx\",\n    _s = $RefreshSig$();\n\nimport React from \"react\";\nimport { useHistory } from \"react-router-dom\";\nimport { updateCard } from \"../../utils/api\";\nimport { colorsList, getBase64, colorsNames } from \"../../utils/constants\";\nimport returnIcon from \"../../images/left.svg\";\nimport addImgIcon from \"../../images/image.svg\";\nimport removeIcon from \"../../images/trash.svg\";\nimport { ButtonSecondary } from \"../ui/button-secondary/button-secondary\";\nimport { Input } from \"../ui/input/input\";\nimport { ButtonForm } from \"../ui/button-form/button-form\";\nimport { Select } from \"../ui/select/select\";\nimport { ColorsBox } from \"../ui/colors-box/colors-box\";\nimport styles from \"./edit-card-page.module.css\";\nimport { jsxDEV as _jsxDEV } from \"react/jsx-dev-runtime\";\nexport const EditCardPage = _ref => {\n  _s();\n\n  let {\n    data,\n    setData,\n    extraClass = \"\"\n  } = _ref;\n  const [currentColor, setCurrentColor] = React.useState(\"#FFFFFF\");\n  const [card, setCard] = React.useState({});\n  const [achievements, setAchievements] = React.useState(\"\");\n  const [currentFileName, setCurrentFileName] = React.useState(\"\");\n  const [errorName, setErrorName] = React.useState(\"\");\n  const [errorAge, setErrorAge] = React.useState(\"\");\n  const history = useHistory();\n  React.useEffect(() => {\n    if (data.id) {\n      setCard(data);\n      setCurrentColor(colorsNames[data.color]);\n      let resString = \"\";\n      data.achievements.forEach(item => {\n        resString ? resString += `, ${item.achievement_name}` : resString = item.achievement_name;\n      });\n      setAchievements(resString);\n    }\n  }, [data, setData]);\n\n  const onChangeInput = e => {\n    setCard({ ...card,\n      [e.target.name]: e.target.value\n    });\n    e.target.name === \"image\" && setCurrentFileName(e.target.value);\n  };\n\n  const handleReturn = () => {\n    history.goBack();\n  };\n\n  const handleRemoveImg = () => {\n    setCard({ ...card,\n      image: null\n    });\n  };\n\n  const handleResponse = res => {\n    if (typeof res.name === \"object\") {\n      setErrorName(\"Поле с именем является обязательным\");\n    } else if (typeof res.birth_year === \"object\") {\n      setErrorAge(\"Поле с годом рождения является обязательным\");\n    }\n  };\n\n  const handleSubmit = () => {\n    errorAge && setErrorAge(\"\");\n    errorName && setErrorName(\"\");\n    const totalCard = {};\n    const photo = document.querySelector('input[type=\"file\"]').files[0];\n\n    if (data.name !== card.name) {\n      totalCard[\"name\"] = card.name;\n    }\n\n    if (data.color !== card.color) {\n      totalCard[\"color\"] = card.color;\n    }\n\n    if (data.birth_year !== card.birth_year) {\n      totalCard[\"birth_year\"] = card.birth_year;\n    }\n\n    if (data.image !== card.image && card.image === null) {\n      totalCard[\"image\"] = card.image;\n    }\n\n    if (JSON.stringify(data.achievements) !== JSON.stringify(card.achievements)) {\n      totalCard[\"achievements\"] = card.achievements;\n    }\n\n    if (photo) {\n      getBase64(photo).then(data => {\n        totalCard[\"image\"] = data;\n        updateCard(totalCard, card.id).then(res => {\n          if (res && res.id) {\n            history.replace({\n              pathname: `/dogs/${res.id}`\n            });\n          }\n        }).catch(handleResponse);\n      });\n    } else {\n      updateCard(totalCard, card.id).then(res => {\n        if (res && res.id) {\n          history.replace({\n            pathname: `/dogs/${res.id}`\n          });\n        }\n      }).catch(handleResponse);\n    }\n  };\n\n  return /*#__PURE__*/_jsxDEV(\"div\", {\n    className: `${styles.content} ${extraClass}`,\n    children: [/*#__PURE__*/_jsxDEV(\"h2\", {\n      className: \"text text_type_h2 text_color_primary mt-25 mb-9\",\n      children: \"\\u0420\\u0435\\u0434\\u0430\\u043A\\u0442\\u0438\\u0440\\u043E\\u0432\\u0430\\u0442\\u044C \\u0441\\u043E\\u0431\\u0430\\u043A\\u0435\\u043D\\u0430\"\n    }, void 0, false, {\n      fileName: _jsxFileName,\n      lineNumber: 115,\n      columnNumber: 7\n    }, this), /*#__PURE__*/_jsxDEV(ButtonSecondary, {\n      extraClass: styles.return_btn_mobile,\n      icon: returnIcon,\n      onClick: handleReturn\n    }, void 0, false, {\n      fileName: _jsxFileName,\n      lineNumber: 118,\n      columnNumber: 7\n    }, this), /*#__PURE__*/_jsxDEV(\"div\", {\n      className: styles.container,\n      children: [!currentFileName && card.image ? /*#__PURE__*/_jsxDEV(\"div\", {\n        className: styles.img_box,\n        children: [/*#__PURE__*/_jsxDEV(\"img\", {\n          className: styles.current_img,\n          src: card.image,\n          alt: \"\\u0424\\u043E\\u0442\\u043E \\u0441\\u043E\\u0431\\u0430\\u043A\\u0435\\u043D\\u0430.\"\n        }, void 0, false, {\n          fileName: _jsxFileName,\n          lineNumber: 126,\n          columnNumber: 13\n        }, this), /*#__PURE__*/_jsxDEV(ButtonSecondary, {\n          extraClass: styles.remove_btn,\n          icon: removeIcon,\n          onClick: handleRemoveImg\n        }, void 0, false, {\n          fileName: _jsxFileName,\n          lineNumber: 131,\n          columnNumber: 13\n        }, this)]\n      }, void 0, true, {\n        fileName: _jsxFileName,\n        lineNumber: 125,\n        columnNumber: 11\n      }, this) : /*#__PURE__*/_jsxDEV(\"label\", {\n        htmlFor: \"image\",\n        className: styles.img_box,\n        children: [/*#__PURE__*/_jsxDEV(\"img\", {\n          className: styles.img,\n          src: addImgIcon,\n          alt: \"\\u0414\\u043E\\u0431\\u0430\\u0432\\u0438\\u0442\\u044C \\u0444\\u043E\\u0442\\u043E \\u0441\\u043E\\u0431\\u0430\\u043A\\u0435\\u043D\\u0430.\"\n        }, void 0, false, {\n          fileName: _jsxFileName,\n          lineNumber: 139,\n          columnNumber: 13\n        }, this), /*#__PURE__*/_jsxDEV(\"p\", {\n          className: \"text text_type_medium-16 text_color_primary\",\n          children: currentFileName ? currentFileName : \"Загрузите фото в фотрмате JPG\"\n        }, void 0, false, {\n          fileName: _jsxFileName,\n          lineNumber: 144,\n          columnNumber: 13\n        }, this)]\n      }, void 0, true, {\n        fileName: _jsxFileName,\n        lineNumber: 138,\n        columnNumber: 11\n      }, this), /*#__PURE__*/_jsxDEV(\"input\", {\n        type: \"file\",\n        className: styles.file_input,\n        name: \"image\",\n        id: \"image\",\n        onChange: onChangeInput\n      }, void 0, false, {\n        fileName: _jsxFileName,\n        lineNumber: 151,\n        columnNumber: 9\n      }, this), /*#__PURE__*/_jsxDEV(Input, {\n        type: \"text\",\n        placeholder: \"\\u0418\\u043C\\u044F \\u0441\\u043E\\u0431\\u0430\\u043A\\u0435\\u043D\\u0430\",\n        name: \"name\",\n        defaultValue: card.name,\n        onChange: onChangeInput,\n        error: errorName\n      }, void 0, false, {\n        fileName: _jsxFileName,\n        lineNumber: 158,\n        columnNumber: 9\n      }, this), /*#__PURE__*/_jsxDEV(Input, {\n        type: \"text\",\n        placeholder: \"\\u0413\\u043E\\u0434 \\u0440\\u043E\\u0436\\u0434\\u0435\\u043D\\u0438\\u044F\",\n        name: \"birth_year\",\n        defaultValue: card.birth_year,\n        onChange: onChangeInput,\n        error: errorAge\n      }, void 0, false, {\n        fileName: _jsxFileName,\n        lineNumber: 166,\n        columnNumber: 9\n      }, this), /*#__PURE__*/_jsxDEV(ColorsBox, {\n        colorsList: colorsList,\n        currentColor: currentColor,\n        setCurrentColor: setCurrentColor,\n        card: card,\n        setCard: setCard\n      }, void 0, false, {\n        fileName: _jsxFileName,\n        lineNumber: 174,\n        columnNumber: 9\n      }, this), /*#__PURE__*/_jsxDEV(Select, {\n        card: card,\n        setCard: setCard,\n        userAchievements: achievements\n      }, void 0, false, {\n        fileName: _jsxFileName,\n        lineNumber: 181,\n        columnNumber: 9\n      }, this), /*#__PURE__*/_jsxDEV(ButtonForm, {\n        extraClass: styles.submit_btn,\n        text: \"\\u0421\\u043E\\u0445\\u0440\\u0430\\u043D\\u0438\\u0442\\u044C\",\n        onClick: handleSubmit\n      }, void 0, false, {\n        fileName: _jsxFileName,\n        lineNumber: 182,\n        columnNumber: 9\n      }, this), /*#__PURE__*/_jsxDEV(ButtonSecondary, {\n        extraClass: styles.return_btn,\n        icon: returnIcon,\n        onClick: handleReturn\n      }, void 0, false, {\n        fileName: _jsxFileName,\n        lineNumber: 187,\n        columnNumber: 9\n      }, this)]\n    }, void 0, true, {\n      fileName: _jsxFileName,\n      lineNumber: 123,\n      columnNumber: 7\n    }, this)]\n  }, void 0, true, {\n    fileName: _jsxFileName,\n    lineNumber: 114,\n    columnNumber: 5\n  }, this);\n};\n\n_s(EditCardPage, \"q5uTWBu3f+dWtdQZ0LCpYDzY5r8=\", false, function () {\n  return [useHistory];\n});\n\n_c = EditCardPage;\n\nvar _c;\n\n$RefreshReg$(_c, \"EditCardPage\");","map":{"version":3,"sources":["/home/botrott/Dev/kittygram_frontend/src/components/edit-card-page/edit-card-page.jsx"],"names":["React","useHistory","updateCard","colorsList","getBase64","colorsNames","returnIcon","addImgIcon","removeIcon","ButtonSecondary","Input","ButtonForm","Select","ColorsBox","styles","EditCardPage","data","setData","extraClass","currentColor","setCurrentColor","useState","card","setCard","achievements","setAchievements","currentFileName","setCurrentFileName","errorName","setErrorName","errorAge","setErrorAge","history","useEffect","id","color","resString","forEach","item","achievement_name","onChangeInput","e","target","name","value","handleReturn","goBack","handleRemoveImg","image","handleResponse","res","birth_year","handleSubmit","totalCard","photo","document","querySelector","files","JSON","stringify","then","replace","pathname","catch","content","return_btn_mobile","container","img_box","current_img","remove_btn","img","file_input","submit_btn","return_btn"],"mappings":";;;AAAA,OAAOA,KAAP,MAAkB,OAAlB;AACA,SAASC,UAAT,QAA2B,kBAA3B;AAEA,SAASC,UAAT,QAA2B,iBAA3B;AACA,SAASC,UAAT,EAAqBC,SAArB,EAAgCC,WAAhC,QAAmD,uBAAnD;AAEA,OAAOC,UAAP,MAAuB,uBAAvB;AACA,OAAOC,UAAP,MAAuB,wBAAvB;AACA,OAAOC,UAAP,MAAuB,wBAAvB;AAEA,SAASC,eAAT,QAAgC,yCAAhC;AACA,SAASC,KAAT,QAAsB,mBAAtB;AACA,SAASC,UAAT,QAA2B,+BAA3B;AACA,SAASC,MAAT,QAAuB,qBAAvB;AACA,SAASC,SAAT,QAA0B,6BAA1B;AAEA,OAAOC,MAAP,MAAmB,6BAAnB;;AAEA,OAAO,MAAMC,YAAY,GAAG,QAAwC;AAAA;;AAAA,MAAvC;AAAEC,IAAAA,IAAF;AAAQC,IAAAA,OAAR;AAAiBC,IAAAA,UAAU,GAAG;AAA9B,GAAuC;AAClE,QAAM,CAACC,YAAD,EAAeC,eAAf,IAAkCpB,KAAK,CAACqB,QAAN,CAAe,SAAf,CAAxC;AACA,QAAM,CAACC,IAAD,EAAOC,OAAP,IAAkBvB,KAAK,CAACqB,QAAN,CAAe,EAAf,CAAxB;AACA,QAAM,CAACG,YAAD,EAAeC,eAAf,IAAkCzB,KAAK,CAACqB,QAAN,CAAe,EAAf,CAAxC;AACA,QAAM,CAACK,eAAD,EAAkBC,kBAAlB,IAAwC3B,KAAK,CAACqB,QAAN,CAAe,EAAf,CAA9C;AACA,QAAM,CAACO,SAAD,EAAYC,YAAZ,IAA4B7B,KAAK,CAACqB,QAAN,CAAe,EAAf,CAAlC;AACA,QAAM,CAACS,QAAD,EAAWC,WAAX,IAA0B/B,KAAK,CAACqB,QAAN,CAAe,EAAf,CAAhC;AAEA,QAAMW,OAAO,GAAG/B,UAAU,EAA1B;AAEAD,EAAAA,KAAK,CAACiC,SAAN,CAAgB,MAAM;AACpB,QAAIjB,IAAI,CAACkB,EAAT,EAAa;AACXX,MAAAA,OAAO,CAACP,IAAD,CAAP;AACAI,MAAAA,eAAe,CAACf,WAAW,CAACW,IAAI,CAACmB,KAAN,CAAZ,CAAf;AACA,UAAIC,SAAS,GAAG,EAAhB;AACApB,MAAAA,IAAI,CAACQ,YAAL,CAAkBa,OAAlB,CAA2BC,IAAD,IAAU;AAClCF,QAAAA,SAAS,GACJA,SAAS,IAAK,KAAIE,IAAI,CAACC,gBAAiB,EADpC,GAEJH,SAAS,GAAGE,IAAI,CAACC,gBAFtB;AAGD,OAJD;AAKAd,MAAAA,eAAe,CAACW,SAAD,CAAf;AACD;AACF,GAZD,EAYG,CAACpB,IAAD,EAAOC,OAAP,CAZH;;AAcA,QAAMuB,aAAa,GAAIC,CAAD,IAAO;AAC3BlB,IAAAA,OAAO,CAAC,EACN,GAAGD,IADG;AAEN,OAACmB,CAAC,CAACC,MAAF,CAASC,IAAV,GAAiBF,CAAC,CAACC,MAAF,CAASE;AAFpB,KAAD,CAAP;AAIAH,IAAAA,CAAC,CAACC,MAAF,CAASC,IAAT,KAAkB,OAAlB,IAA6BhB,kBAAkB,CAACc,CAAC,CAACC,MAAF,CAASE,KAAV,CAA/C;AACD,GAND;;AAQA,QAAMC,YAAY,GAAG,MAAM;AACzBb,IAAAA,OAAO,CAACc,MAAR;AACD,GAFD;;AAIA,QAAMC,eAAe,GAAG,MAAM;AAC5BxB,IAAAA,OAAO,CAAC,EAAE,GAAGD,IAAL;AAAW0B,MAAAA,KAAK,EAAE;AAAlB,KAAD,CAAP;AACD,GAFD;;AAIA,QAAMC,cAAc,GAAIC,GAAD,IAAS;AAC9B,QAAI,OAAOA,GAAG,CAACP,IAAX,KAAoB,QAAxB,EAAkC;AAChCd,MAAAA,YAAY,CAAC,qCAAD,CAAZ;AACD,KAFD,MAEO,IAAI,OAAOqB,GAAG,CAACC,UAAX,KAA0B,QAA9B,EAAwC;AAC7CpB,MAAAA,WAAW,CAAC,6CAAD,CAAX;AACD;AACF,GAND;;AAQA,QAAMqB,YAAY,GAAG,MAAM;AACzBtB,IAAAA,QAAQ,IAAIC,WAAW,CAAC,EAAD,CAAvB;AACAH,IAAAA,SAAS,IAAIC,YAAY,CAAC,EAAD,CAAzB;AAEA,UAAMwB,SAAS,GAAG,EAAlB;AACA,UAAMC,KAAK,GAAGC,QAAQ,CAACC,aAAT,CAAuB,oBAAvB,EAA6CC,KAA7C,CAAmD,CAAnD,CAAd;;AACA,QAAIzC,IAAI,CAAC2B,IAAL,KAAcrB,IAAI,CAACqB,IAAvB,EAA6B;AAC3BU,MAAAA,SAAS,CAAC,MAAD,CAAT,GAAoB/B,IAAI,CAACqB,IAAzB;AACD;;AACD,QAAI3B,IAAI,CAACmB,KAAL,KAAeb,IAAI,CAACa,KAAxB,EAA+B;AAC7BkB,MAAAA,SAAS,CAAC,OAAD,CAAT,GAAqB/B,IAAI,CAACa,KAA1B;AACD;;AACD,QAAInB,IAAI,CAACmC,UAAL,KAAoB7B,IAAI,CAAC6B,UAA7B,EAAyC;AACvCE,MAAAA,SAAS,CAAC,YAAD,CAAT,GAA0B/B,IAAI,CAAC6B,UAA/B;AACD;;AACD,QAAInC,IAAI,CAACgC,KAAL,KAAe1B,IAAI,CAAC0B,KAApB,IAA6B1B,IAAI,CAAC0B,KAAL,KAAe,IAAhD,EAAsD;AACpDK,MAAAA,SAAS,CAAC,OAAD,CAAT,GAAqB/B,IAAI,CAAC0B,KAA1B;AACD;;AACD,QACEU,IAAI,CAACC,SAAL,CAAe3C,IAAI,CAACQ,YAApB,MAAsCkC,IAAI,CAACC,SAAL,CAAerC,IAAI,CAACE,YAApB,CADxC,EAEE;AACA6B,MAAAA,SAAS,CAAC,cAAD,CAAT,GAA4B/B,IAAI,CAACE,YAAjC;AACD;;AAED,QAAI8B,KAAJ,EAAW;AACTlD,MAAAA,SAAS,CAACkD,KAAD,CAAT,CAAiBM,IAAjB,CAAuB5C,IAAD,IAAU;AAC9BqC,QAAAA,SAAS,CAAC,OAAD,CAAT,GAAqBrC,IAArB;AACAd,QAAAA,UAAU,CAACmD,SAAD,EAAY/B,IAAI,CAACY,EAAjB,CAAV,CACG0B,IADH,CACSV,GAAD,IAAS;AACb,cAAIA,GAAG,IAAIA,GAAG,CAAChB,EAAf,EAAmB;AACjBF,YAAAA,OAAO,CAAC6B,OAAR,CAAgB;AAAEC,cAAAA,QAAQ,EAAG,SAAQZ,GAAG,CAAChB,EAAG;AAA5B,aAAhB;AACD;AACF,SALH,EAMG6B,KANH,CAMSd,cANT;AAOD,OATD;AAUD,KAXD,MAWO;AACL/C,MAAAA,UAAU,CAACmD,SAAD,EAAY/B,IAAI,CAACY,EAAjB,CAAV,CACG0B,IADH,CACSV,GAAD,IAAS;AACb,YAAIA,GAAG,IAAIA,GAAG,CAAChB,EAAf,EAAmB;AACjBF,UAAAA,OAAO,CAAC6B,OAAR,CAAgB;AAAEC,YAAAA,QAAQ,EAAG,SAAQZ,GAAG,CAAChB,EAAG;AAA5B,WAAhB;AACD;AACF,OALH,EAMG6B,KANH,CAMSd,cANT;AAOD;AACF,GA5CD;;AA8CA,sBACE;AAAK,IAAA,SAAS,EAAG,GAAEnC,MAAM,CAACkD,OAAQ,IAAG9C,UAAW,EAAhD;AAAA,4BACE;AAAI,MAAA,SAAS,EAAC,iDAAd;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA,YADF,eAIE,QAAC,eAAD;AACE,MAAA,UAAU,EAAEJ,MAAM,CAACmD,iBADrB;AAEE,MAAA,IAAI,EAAE3D,UAFR;AAGE,MAAA,OAAO,EAAEuC;AAHX;AAAA;AAAA;AAAA;AAAA,YAJF,eASE;AAAK,MAAA,SAAS,EAAE/B,MAAM,CAACoD,SAAvB;AAAA,iBACG,CAACxC,eAAD,IAAoBJ,IAAI,CAAC0B,KAAzB,gBACC;AAAK,QAAA,SAAS,EAAElC,MAAM,CAACqD,OAAvB;AAAA,gCACE;AACE,UAAA,SAAS,EAAErD,MAAM,CAACsD,WADpB;AAEE,UAAA,GAAG,EAAE9C,IAAI,CAAC0B,KAFZ;AAGE,UAAA,GAAG,EAAC;AAHN;AAAA;AAAA;AAAA;AAAA,gBADF,eAME,QAAC,eAAD;AACE,UAAA,UAAU,EAAElC,MAAM,CAACuD,UADrB;AAEE,UAAA,IAAI,EAAE7D,UAFR;AAGE,UAAA,OAAO,EAAEuC;AAHX;AAAA;AAAA;AAAA;AAAA,gBANF;AAAA;AAAA;AAAA;AAAA;AAAA,cADD,gBAcC;AAAO,QAAA,OAAO,EAAC,OAAf;AAAuB,QAAA,SAAS,EAAEjC,MAAM,CAACqD,OAAzC;AAAA,gCACE;AACE,UAAA,SAAS,EAAErD,MAAM,CAACwD,GADpB;AAEE,UAAA,GAAG,EAAE/D,UAFP;AAGE,UAAA,GAAG,EAAC;AAHN;AAAA;AAAA;AAAA;AAAA,gBADF,eAME;AAAG,UAAA,SAAS,EAAC,6CAAb;AAAA,oBACGmB,eAAe,GACZA,eADY,GAEZ;AAHN;AAAA;AAAA;AAAA;AAAA,gBANF;AAAA;AAAA;AAAA;AAAA;AAAA,cAfJ,eA4BE;AACE,QAAA,IAAI,EAAC,MADP;AAEE,QAAA,SAAS,EAAEZ,MAAM,CAACyD,UAFpB;AAGE,QAAA,IAAI,EAAC,OAHP;AAIE,QAAA,EAAE,EAAC,OAJL;AAKE,QAAA,QAAQ,EAAE/B;AALZ;AAAA;AAAA;AAAA;AAAA,cA5BF,eAmCE,QAAC,KAAD;AACE,QAAA,IAAI,EAAC,MADP;AAEE,QAAA,WAAW,EAAC,qEAFd;AAGE,QAAA,IAAI,EAAC,MAHP;AAIE,QAAA,YAAY,EAAElB,IAAI,CAACqB,IAJrB;AAKE,QAAA,QAAQ,EAAEH,aALZ;AAME,QAAA,KAAK,EAAEZ;AANT;AAAA;AAAA;AAAA;AAAA,cAnCF,eA2CE,QAAC,KAAD;AACE,QAAA,IAAI,EAAC,MADP;AAEE,QAAA,WAAW,EAAC,qEAFd;AAGE,QAAA,IAAI,EAAC,YAHP;AAIE,QAAA,YAAY,EAAEN,IAAI,CAAC6B,UAJrB;AAKE,QAAA,QAAQ,EAAEX,aALZ;AAME,QAAA,KAAK,EAAEV;AANT;AAAA;AAAA;AAAA;AAAA,cA3CF,eAmDE,QAAC,SAAD;AACE,QAAA,UAAU,EAAE3B,UADd;AAEE,QAAA,YAAY,EAAEgB,YAFhB;AAGE,QAAA,eAAe,EAAEC,eAHnB;AAIE,QAAA,IAAI,EAAEE,IAJR;AAKE,QAAA,OAAO,EAAEC;AALX;AAAA;AAAA;AAAA;AAAA,cAnDF,eA0DE,QAAC,MAAD;AAAQ,QAAA,IAAI,EAAED,IAAd;AAAoB,QAAA,OAAO,EAAEC,OAA7B;AAAsC,QAAA,gBAAgB,EAAEC;AAAxD;AAAA;AAAA;AAAA;AAAA,cA1DF,eA2DE,QAAC,UAAD;AACE,QAAA,UAAU,EAAEV,MAAM,CAAC0D,UADrB;AAEE,QAAA,IAAI,EAAC,wDAFP;AAGE,QAAA,OAAO,EAAEpB;AAHX;AAAA;AAAA;AAAA;AAAA,cA3DF,eAgEE,QAAC,eAAD;AACE,QAAA,UAAU,EAAEtC,MAAM,CAAC2D,UADrB;AAEE,QAAA,IAAI,EAAEnE,UAFR;AAGE,QAAA,OAAO,EAAEuC;AAHX;AAAA;AAAA;AAAA;AAAA,cAhEF;AAAA;AAAA;AAAA;AAAA;AAAA,YATF;AAAA;AAAA;AAAA;AAAA;AAAA,UADF;AAkFD,CAhLM;;GAAM9B,Y;UAQKd,U;;;KARLc,Y","sourcesContent":["import React from \"react\";\nimport { useHistory } from \"react-router-dom\";\n\nimport { updateCard } from \"../../utils/api\";\nimport { colorsList, getBase64, colorsNames } from \"../../utils/constants\";\n\nimport returnIcon from \"../../images/left.svg\";\nimport addImgIcon from \"../../images/image.svg\";\nimport removeIcon from \"../../images/trash.svg\";\n\nimport { ButtonSecondary } from \"../ui/button-secondary/button-secondary\";\nimport { Input } from \"../ui/input/input\";\nimport { ButtonForm } from \"../ui/button-form/button-form\";\nimport { Select } from \"../ui/select/select\";\nimport { ColorsBox } from \"../ui/colors-box/colors-box\";\n\nimport styles from \"./edit-card-page.module.css\";\n\nexport const EditCardPage = ({ data, setData, extraClass = \"\" }) => {\n  const [currentColor, setCurrentColor] = React.useState(\"#FFFFFF\");\n  const [card, setCard] = React.useState({});\n  const [achievements, setAchievements] = React.useState(\"\");\n  const [currentFileName, setCurrentFileName] = React.useState(\"\");\n  const [errorName, setErrorName] = React.useState(\"\");\n  const [errorAge, setErrorAge] = React.useState(\"\");\n\n  const history = useHistory();\n\n  React.useEffect(() => {\n    if (data.id) {\n      setCard(data);\n      setCurrentColor(colorsNames[data.color]);\n      let resString = \"\";\n      data.achievements.forEach((item) => {\n        resString\n          ? (resString += `, ${item.achievement_name}`)\n          : (resString = item.achievement_name);\n      });\n      setAchievements(resString);\n    }\n  }, [data, setData]);\n\n  const onChangeInput = (e) => {\n    setCard({\n      ...card,\n      [e.target.name]: e.target.value,\n    });\n    e.target.name === \"image\" && setCurrentFileName(e.target.value);\n  };\n\n  const handleReturn = () => {\n    history.goBack();\n  };\n\n  const handleRemoveImg = () => {\n    setCard({ ...card, image: null });\n  };\n\n  const handleResponse = (res) => {\n    if (typeof res.name === \"object\") {\n      setErrorName(\"Поле с именем является обязательным\");\n    } else if (typeof res.birth_year === \"object\") {\n      setErrorAge(\"Поле с годом рождения является обязательным\");\n    }\n  };\n\n  const handleSubmit = () => {\n    errorAge && setErrorAge(\"\");\n    errorName && setErrorName(\"\");\n\n    const totalCard = {};\n    const photo = document.querySelector('input[type=\"file\"]').files[0];\n    if (data.name !== card.name) {\n      totalCard[\"name\"] = card.name;\n    }\n    if (data.color !== card.color) {\n      totalCard[\"color\"] = card.color;\n    }\n    if (data.birth_year !== card.birth_year) {\n      totalCard[\"birth_year\"] = card.birth_year;\n    }\n    if (data.image !== card.image && card.image === null) {\n      totalCard[\"image\"] = card.image;\n    }\n    if (\n      JSON.stringify(data.achievements) !== JSON.stringify(card.achievements)\n    ) {\n      totalCard[\"achievements\"] = card.achievements;\n    }\n\n    if (photo) {\n      getBase64(photo).then((data) => {\n        totalCard[\"image\"] = data;\n        updateCard(totalCard, card.id)\n          .then((res) => {\n            if (res && res.id) {\n              history.replace({ pathname: `/dogs/${res.id}` });\n            }\n          })\n          .catch(handleResponse);\n      });\n    } else {\n      updateCard(totalCard, card.id)\n        .then((res) => {\n          if (res && res.id) {\n            history.replace({ pathname: `/dogs/${res.id}` });\n          }\n        })\n        .catch(handleResponse);\n    }\n  };\n\n  return (\n    <div className={`${styles.content} ${extraClass}`}>\n      <h2 className=\"text text_type_h2 text_color_primary mt-25 mb-9\">\n        Редактировать собакена\n      </h2>\n      <ButtonSecondary\n        extraClass={styles.return_btn_mobile}\n        icon={returnIcon}\n        onClick={handleReturn}\n      />\n      <div className={styles.container}>\n        {!currentFileName && card.image ? (\n          <div className={styles.img_box}>\n            <img\n              className={styles.current_img}\n              src={card.image}\n              alt=\"Фото собакена.\"\n            />\n            <ButtonSecondary\n              extraClass={styles.remove_btn}\n              icon={removeIcon}\n              onClick={handleRemoveImg}\n            />\n          </div>\n        ) : (\n          <label htmlFor=\"image\" className={styles.img_box}>\n            <img\n              className={styles.img}\n              src={addImgIcon}\n              alt=\"Добавить фото собакена.\"\n            />\n            <p className=\"text text_type_medium-16 text_color_primary\">\n              {currentFileName\n                ? currentFileName\n                : \"Загрузите фото в фотрмате JPG\"}\n            </p>\n          </label>\n        )}\n        <input\n          type=\"file\"\n          className={styles.file_input}\n          name=\"image\"\n          id=\"image\"\n          onChange={onChangeInput}\n        />\n        <Input\n          type=\"text\"\n          placeholder=\"Имя собакена\"\n          name=\"name\"\n          defaultValue={card.name}\n          onChange={onChangeInput}\n          error={errorName}\n        />\n        <Input\n          type=\"text\"\n          placeholder=\"Год рождения\"\n          name=\"birth_year\"\n          defaultValue={card.birth_year}\n          onChange={onChangeInput}\n          error={errorAge}\n        />\n        <ColorsBox\n          colorsList={colorsList}\n          currentColor={currentColor}\n          setCurrentColor={setCurrentColor}\n          card={card}\n          setCard={setCard}\n        />\n        <Select card={card} setCard={setCard} userAchievements={achievements} />\n        <ButtonForm\n          extraClass={styles.submit_btn}\n          text=\"Сохранить\"\n          onClick={handleSubmit}\n        />\n        <ButtonSecondary\n          extraClass={styles.return_btn}\n          icon={returnIcon}\n          onClick={handleReturn}\n        />\n      </div>\n    </div>\n  );\n};\n"]},"metadata":{},"sourceType":"module"}